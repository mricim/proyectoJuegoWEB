<!doctype html>
<html lang="es">

<head>
    <script>
        function includeHTML(name) {
            var z, i, elmnt, file, xhttp;
            /* Loop through a collection of all HTML elements: */
            z = document.getElementsByTagName("*");
            for (i = 0; i < z.length; i++) {
                elmnt = z[i];
                /*search for elements with a certain atrribute:*/
                //file = elmnt.getAttribute("w3-include-html");
                file = elmnt.getAttribute(name);
                if (file) {
                    /* Make an HTTP request using the attribute value as the file name: */
                    xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function () {
                        if (this.readyState == 4) {
                            if (this.status == 200) {
                                elmnt.innerHTML = this.responseText;
                            }
                            if (this.status == 404) {
                                elmnt.innerHTML = "Page not found.";
                            }
                            /* Remove the attribute, and call this function once more: */
                            //elmnt.removeAttribute("w3-include-html");
                            elmnt.removeAttribute(name);
                            includeHTML();
                        }
                    }
                    //xhttp.open("GET", file, true);
                    xhttp.open("GET", file, true);
                    xhttp.send();
                    /* Exit the function: */
                    return;
                }
            }
        }
    </script>
    <!--
    <div onload="includeHTML();" w3-include-html="\add\header.html">
        <script>
            includeHTML();
        </script>
    </div>
    -->


    <div head="..\add\01head.html">
        <script>
            includeHTML("head");
        </script>
    </div>


    <!-- Funciones JS-->
    <script src="\includes\js\parameter.js"></script>
    <!-- Funciones JS FIN-->

    <script src="https://www.google.com/recaptcha/api.js?render=6LctbbsUAAAAAHVc5Cp-j8FZKOZG1wAH0eUV690D"></script>

</head>
<body onload="Captcha()">

<div style="background-color:#848484;">
    <div menu="..\add\02menu.html">
        <script>
            includeHTML("menu");
        </script>
    </div>


    <main class="container" role="main" style="padding-bottom: 70px;">
        <script src='/includes/js/captcha.js'></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script type="text/javascript">
            //Check mail
            function checkMail(mail) {
                if (!(/^([a-zA-Z0-9._]+)@([a-zA-Z0-9]+)\.([a-zA-Z]{2,4})$/.test(mail))) {
                    $("#email").prop("style", "border: 1px solid red");
                    //$("#buttonRegister").prop('disabled', true);
                } else {
                    $.ajax({
                        method: "POST",
                        url: "/includes/functions/php/user_exists.php",
                        data: {
                            m: mail
                        },
                        success: function (mailExists) {
                            if (mailExists == "0" || mailExists == 0) {
                                //$("#button_sender").prop('disabled', true);
                                $("#email").prop("style", "border: 1px solid red");
                            } else {
                                $("#email").removeAttr("style");
                                //$("#button_sender").prop('disabled', false);
                            }
                        }
                    })
                }
            }

            //Check 2 passwords
            var pass = "";

            function checkPass(p) {
                pass = p;
            }

            function checkPassRepeat(p) {
                if (p == pass) {
                    $("#passwordRepet").removeAttr("style");
                    $("#passwordRepet").prop("style","margin-top: 0px; margin-left: 450px;margin-right:10px;");
                } else {
                    $("#passwordRepet").prop("style", "border: 1px solid red; margin-top: 0px; margin-left: 450px;margin-right:10px;");
                }
            }

            //Button disabled
            /*window.addEventListener('load', function disabledButtons() {
                $("#button_sender").prop('disabled', true);
            })*/

            //Check captcha
            function checkCaptcha(inputValueAux) {
                var captchaAux = document.getElementById("mainCaptcha").textContent;


                captcha = captchaAux.replace(/ /g, "");
                inputValue = inputValueAux.replace(/ /g, "");


                if (captcha == inputValue) {
                    $("#txtInput").removeAttr("style");
                    $("#button_sender").prop('disabled', false);

                } else {
                    $("#txtInput").prop("style", "border: 1px solid red");
                    $("#button_sender").prop('disabled', true);
                }
            }
        </script>
        <div class="my-3 p-3 bg-white rounded shadow-sm">
            <h6 class="border-bottom border-gray pb-2 mb-5 md-5">Register</h6>
            <div class="containter">
                <form action="/en/users/insertUser.php" id="comment_form" method="POST">
                    <div class="row">
                        <input aria-label="email" class="form-control col-10 col-lg-4 offset-1" id="email"
                               name="email" placeholder="Email" type="text" onkeyup="checkMail(this.value)" required>
                        <input aria-label="password" class="form-control col-10 col-lg-4 offset-1 offset-lg-2"
                               id="password" name="password" placeholder="Password" type="password"
                               onkeyup="checkPass(this.value)" required>
                        <div class="clearfix"></div>
                        <br><br>
                        <input aria-label="name" class="form-control col-10 col-lg-4 offset-1" id="user"
                               name="name" placeholder="Name User" type="text" required>
                        <input aria-label="passwordRepet" class="form-control col-10 col-lg-4 offset-1 offset-lg-2"
                               id="passwordRepet" name="passwordRepet" placeholder="Password Repet"
                               type="password" onkeyup="checkPassRepeat(this.value)" required>

                        <input class="recaptcha_response" disabled id="recaptcha_response" name="recaptcha_response"
                               type="hidden">
                        <input class="key" disabled id="key" name="key" type="hidden" value=''>
                        <input class="send" disabled id="send" name="send" type="hidden" value='register.html'>
                        <button class="btn btn-outline-success my-0 my-sm-0 offset-1" id="button_sender" name="button_sender"
                                type="submit" disabled style="margin-left:520px;">Register
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <div class="my-3 p-3 bg-white rounded shadow-sm">
            <h6 class="border-bottom border-gray pb-2">Captcha</h6>
            <div class="containter">
                <canvas id="captcha" style="margin-top: 20px; margin-left: 420px;margin-right:10px;"></canvas>
                <br>
                <input type="button" id="refresh" value="Refresh"
                       onclick="Captcha('mainCaptcha');" style="margin-top: 0px; margin-left: 420px;margin-right:10px;"/><br>
                <input type="text" hidden="hidden" id="mainCaptcha">
                <br>
                <input type="text" id="txtInput" onkeyup="checkCaptcha(this.value)" style="margin-top: 0px; margin-left: 450px;margin-right:10px;"/>
                <br/>
            </div>
        </div>

        <div class="my-5 p-3 bg-white rounded shadow-sm">
            <div class="containter">
                <div class="row justify-content-md-center">
                    This site is protected by reCAPTCHA and the Google&nbsp;
                    <a href="https://policies.google.com/privacy">Privacy Policy</a>&nbsp;and&nbsp;
                    <a href="https://policies.google.com/terms">Terms of Service</a>&nbsp;apply.
                </div>
            </div>
        </div>

    </main>

    <script src="\includes\reCaptcha\reCaptcha.js" type="text/javascript"></script>
    <script>
        var inputText = document.getElementsByClassName('send');
        //alert(inputText[1].value+" "+inputText[1].value.charAt(0));
        if (inputText[0].value.charAt(0) != 'h') {
            var url = window.location.href;
            var usedUrl = window.location.href.slice(0, url.lastIndexOf("/"));
            for (i = 0; i < inputText.length; i++) {
                var cog = inputText[i].value;
                inputText[i].value = usedUrl + '/' + cog;
            }
        }
    </script>
    <script>
        window.setTimeout(function () {
            if (document.getElementById('recaptcha_response').value == "") {
                location.reload();
            } else {
                var buttons = document.getElementsByName('button_sender');
                for (i = 0; i < buttons.length; i++) {
                    buttons[i].disabled = false;
                }
            }
        }, 3000);
    </script>


    <script>
        //var qs = new Querystring ();
        var key_User = findGetParameter('key');
        if (key_User == null) {
            document.getElementById('resultMail').innerHTML = "Error Ocurred";
        }
        document.getElementById('key').value = key_User;

    </script>


</div>
</body>


</html>
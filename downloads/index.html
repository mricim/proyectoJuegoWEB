<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
            text-align: center;
        }

        th, td {
            padding: 15px;
        }
    </style>
</head>
<body>
<!--onload="loadXML()">-->


<table style="width:100%">
    <tr>
        <th>Version</th>
        <th colspan="2">Windows</th>
        <th colspan="2">Linux</th>
        <th colspan="2">Mac</th>
    </tr>
    <tr>
        <td>1.1</td>

        <td><a href="application/installers/windows/0/-12/0/4/20200602/0/ArmegisInstaller.exe" target="_blank">exe</a>
        </td>
        <td><a href="application/installers/windows/0/-12/0/4/20200602/0/ArmegisInstaller.zip" target="_blank">zip</a>
        </td>

        <td><a href="application/installers/linux/0/-12/0/4/20200602/0/Armegis.tar.gz" target="_blank">tar.gz</a></td>
        <td><a href="application/installers/linux/0/-12/0/4/20200602/0/Armegis.zip" target="_blank">zip</a></td>

        <td>mac</td>
        <td>rar</td>
    </tr>
    <tr>
        <td>1.0</td>

        <td><a href="" target="_blank">exe</a></td>
        <td><a href="" target="_blank">zip</a></td>

        <td>npl</td>
        <td>tar.gz</td>

        <td>mac</td>
        <td>rar</td>
    </tr>
    <tr>
        <td>0.9</td>

        <td>exe</td>
        <td>zip</td>

        <td>npl</td>
        <td>tar.gz</td>

        <td>mac</td>
        <td>rar</td>
    </tr>
</table>


<!---



-->
<br><b>VERSIONS</b><br>
<table id="versions">
    <tr>
        <th>Version</th>
        <th>Windows</th>
        <th>Linux</th>
        <th>Mac</th>
    </tr>
</table>
<!--<br><b>WINDOWS</b><br>
<table id="verions">
    <tr>
        <th>Version</th>
        <th>Windows</th>
        <th>Linux</th>
        <th>Mac</th>
    </tr>
</table>

<br><b>LINUX</b><br>
<table id="linuxVersions"></table>

<br><b>MAC</b><br>
<table id="macVersions"></table>-->
<!---



-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script>

    //Load XML files

    var windowsV;
    var macV;
    var linuxV;


    startWindows().then(startMac).then(startLinux).then(checkAllVersions);

    function startWindows() {
        const promise = new Promise(function (resolve, reject) {
            setTimeout(function () {
                windowsV = loadWindows();
                resolve(windowsV)
            }, 1000);
        });

        return promise;

        console.log("1");
    }

    function startMac() {
        const promise = new Promise(function (resolve, reject) {
            setTimeout(function () {
                macV = loadMac();
                console.log("2");
            }, 1000);
        });
        return promise;
    }

    function startLinux() {
        const promise = new Promise(function (resolve, reject) {
            setTimeout(function () {
                linuxV = loadLinux();
                console.log("3");
            },1000);
        });
        return promise;
    }


    var setVersions = new Set();

    //checkAllVersions();

    function checkAllVersions() {
        console.log("4");
        //Add windows versions
        for (var i = 0; i < windowsV.length; i++) {
            setVersions.add(windowsV[i].num);
        }
        //Add mac versions
        for (var i = 0; i < macV.length; i++) {
            setVersions.add(macV[i].num)
        }
        //Add linux versions
        for (var i = 0; i < linuxV.length; i++) {
            setVersions.add(linuxV[i].num)
        }
        createTable(setVersions);
    }


    //Create table
    function createTable(allVersions) {
        console.log("create table + all versions: " + allVersions);
        var table = document.getElementById("versions");

        for (var i = 0; i < allVersions.length; i++) {
            var rowVersion = document.createElement("tr");
            var columnNumVersion = document.createElement("td");
            table.appendChild(rowVersion);
            rowVersion.appendChild(columnNumVersion);
            columnNumVersion.setAttribute("id", allVersions[i]);
            columnNumVersion.textContent = allVersions[i];

            //Windows versions
            for (var j = 0; j < windowsV.length; j++) {
                if (allVersions.has(windowsV[i].num)) {
                    var columnWindows = document.createElement("td");
                    rowVersion.appendChild(columnWindows);
                    columnWindows.textContent = windowsV[i].href;
                }
            }
            //Linux versions
            for (var j = 0; j < linuxV.length; j++) {
                if (allVersions.has(linuxV[i].num)) {
                    var columnLinux = document.createElement("td");
                    rowVersion.appendChild(columnLinux);
                    columnLinux.textContent = linuxV[i].href;
                }
            }
            //Mac versions
            for (var j = 0; j < macV.length; j++) {
                if (allVersions.has(macV[i].num)) {
                    var columnMac = document.createElement("td");
                    rowVersion.appendChild(columnMac);
                    columnMac.textContent = macV[i].href;
                }
            }
        }
    }

    //WINDOWS
    function loadWindows() {
        console.log("WINDOWS");
        loadXMLDoc();

        function loadXMLDoc() {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    myFunction(this);
                }
            };
            xmlhttp.open("GET", "application/installers/windows/testlist.xml", true);
            xmlhttp.send();
        }

        function myFunction(xml) {
            var i;
            var xmlDoc = xml.responseXML;

            var x = xmlDoc.getElementsByTagName("file");

            //Constructor
            function Version(num, href) {
                this.num = num;
                this.href = href;
            };
            var versions = [];
            var oldVersions = [];
            for (var i = 0; i < x.length; i++) {
                var n = x[i].getElementsByTagName("version")[0].childNodes[0].nodeValue;
                var h = x[i].getElementsByTagName("href")[0].childNodes[0].nodeValue;
                var auxVersion = new Version(n, h);
                versions.push(auxVersion);
                oldVersions.push(auxVersion);
            }
            console.log(oldVersions);

            //Check the versions
            for (var i = 0; i < versions.length - 1; i++) {
                var numVersion = (versions[i].num).substring(3, 7);
                var numNextVersion = (versions[i + 1].num).substring(3, 7);

                if (numVersion == numNextVersion) {
                    versions.splice(i, 1);
                }
            }
            console.log("VERSIONS WINDOWS");
            runTableWindows = true;

        }

        return versions;
    }

    //MAC
    function loadMac() {
        console.log("MAC");
        loadXMLDoc();

        function loadXMLDoc() {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    myFunction(this);
                }
            };
            xmlhttp.open("GET", "application/installers/mac/list.xml", true);
            xmlhttp.send();
        }

        function myFunction(xml) {
            var i;
            var xmlDoc = xml.responseXML;

            var x = xmlDoc.getElementsByTagName("file");

            //Constructor
            function Version(num, href) {
                this.num = num;
                this.href = href;
            };
            var versions = [];
            var oldVersions = [];
            for (var i = 0; i < x.length; i++) {
                var n = x[i].getElementsByTagName("version")[0].childNodes[0].nodeValue;
                var h = x[i].getElementsByTagName("href")[0].childNodes[0].nodeValue;
                var auxVersion = new Version(n, h);
                versions.push(auxVersion);
                oldVersions.push(auxVersion);
            }
            console.log(oldVersions);
            //Check the versions
            for (var i = 0; i < versions.length - 1; i++) {
                var numVersion = (versions[i].num).substring(3, 7);
                var numNextVersion = (versions[i + 1].num).substring(3, 7);

                if (numVersion == numNextVersion) {
                    versions.splice(i, 1);
                }
            }
            console.log("VERSIONS MAC");
            runTableMac = true;
            //createTable(versions);

        }

        return versions;
    }

    //LINUX
    function loadLinux() {
        console.log("LINUX");
        loadXMLDoc();

        function loadXMLDoc() {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    myFunction(this);
                }
            };
            xmlhttp.open("GET", "application/installers/linux/list.xml", true);
            xmlhttp.send();
        }

        function myFunction(xml) {
            var i;
            var xmlDoc = xml.responseXML;

            var x = xmlDoc.getElementsByTagName("file");

            //Constructor
            function Version(num, href) {
                this.num = num;
                this.href = href;
            };
            var versions = [];
            var oldVersions = [];
            for (var i = 0; i < x.length; i++) {
                var n = x[i].getElementsByTagName("version")[0].childNodes[0].nodeValue;
                var h = x[i].getElementsByTagName("href")[0].childNodes[0].nodeValue;
                var auxVersion = new Version(n, h);
                versions.push(auxVersion);
                oldVersions.push(auxVersion);
            }
            console.log(oldVersions);
            //Check the versions
            for (var i = 0; i < versions.length - 1; i++) {
                var numVersion = (versions[i].num).substring(3, 7);
                var numNextVersion = (versions[i + 1].num).substring(3, 7);

                if (numVersion == numNextVersion) {
                    versions.splice(i, 1);
                }
            }
            console.log("VERSIONS LINUX");
            runTableLinux = true;

        }

        return versions;
    }
</script>


</body>
</html>
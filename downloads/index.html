<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
            text-align: center;
        }

        th, td {
            padding: 15px;
        }
    </style>
</head>
<body>
<!--onload="loadXML()">-->


<br><b>VERSIONS</b><br>
<table id="versions">
    <tr>
        <th>Version</th>
        <th colspan="2">Windows</th>
        <th colspan="2">Linux</th>
        <th colspan="2">Mac</th>
    </tr>
</table>
<!--<br><b>WINDOWS</b><br>
<table id="verions">
    <tr>
        <th>Version</th>
        <th>Windows</th>
        <th>Linux</th>
        <th>Mac</th>
    </tr>
</table>

<br><b>LINUX</b><br>
<table id="linuxVersions"></table>

<br><b>MAC</b><br>
<table id="macVersions"></table>-->
<!---



-->
<script>

    loadXml();

    function loadXml() {
        var windowsV;
        var macV;
        var linuxV;
        loadXMLDoc("application/installers/windows/testlist.xml", function (windowsV) {
            loadXMLDoc("application/installers/mac/list.xml", function (macV) {
                loadXMLDoc("application/installers/linux/list.xml", function (linuxV) {
                    checkAllVersions(windowsV, macV, linuxV);
                });
            });
        });
    }


    function checkAllVersions(windowsV, macV, linuxV) {

        /*var x = xmlDoc.getElementsByTagName("file");
        for (i = 0; i <x.length; i++) {
            table += "<tr><td>" + x[i].getElementsByTagName("version")[0].childNodes[0].nodeValue + "</td><td>" + x[i].getElementsByTagName("href")[0].childNodes[0].nodeValue + "</td></tr>";
        }*/

        var setVersions = new Set();

        var windowsVersions = myFunction(windowsV);
        var linuxVersions = myFunction(linuxV);
        var macVersions = myFunction(macV);


        //Add windows versions
        for (var i = 0; i < windowsVersions.length; i++) {
            setVersions.add(windowsVersions[i].num);
        }
        //Add mac versions
        for (var i = 0; i < macVersions.length; i++) {
            setVersions.add(macVersions[i].num);
        }
        //Add linux versions
        for (var i = 0; i < linuxVersions.length; i++) {
            setVersions.add(linuxVersions[i].num);
        }
        createTable(setVersions, windowsVersions, linuxVersions, macVersions);
    }


    //Create table
    function createTable(allVersions, windowsVersions, linuxVersions, macVersions) {

        const ruta = "application/installers/";
        var table = document.getElementById("versions");

        var versions = [];

        allVersions.forEach(valor => {
            versions.push(valor);
        });

        versions.sort(function (o1, o2) {
                var e = o2.split(".")[0] - o1.split(".")[0];
                if (e != 0) {
                    return e;
                } else {
                    var e = o2.split(".")[1] - o1.split(".")[1];
                    if (e != 0) {
                        return e;
                    } else {
                        var e = o2.split(".")[2] - o1.split(".")[2];
                        if (e != 0) {
                            return e;
                        } else {
                            var e = o2.split(".")[3] - o1.split(".")[3];
                            if (e != 0) {
                                return e;
                            } else {
                                var e = o2.split(".")[4] - o1.split(".")[4];
                                if (e != 0) {
                                    return e;
                                } else {
                                    var e = o2.split(".")[4] - o1.split(".")[4];
                                    if (e != 0) {
                                        return e;
                                    }
                                }
                            }
                        }
                    }
                }
                return 0;
            }
        );


        for (var i = 0; i < versions.length; i++) {
            var rowVersion = document.createElement("tr");
            var columnNumVersion = document.createElement("td");
            table.appendChild(rowVersion);
            rowVersion.appendChild(columnNumVersion);

            var id = versions[i].split(".")[1];
            columnNumVersion.setAttribute("id", id);

            columnNumVersion.textContent = versions[i];


            //Windows versions
            var versionsW = [];
            windowsVersions.forEach(valor => {
                versionsW.push(valor);
            });
            var windows = false;
            for (var j = 0; j < versionsW.length; j++) {
                if (versions[i] == (versionsW[j].num)) {
                    windows = true;
                    var columnWindows0 = document.createElement("td");
                    rowVersion.appendChild(columnWindows0);
                    var link0 = document.createElement("a");
                    columnWindows0.appendChild(link0);
                    link0.setAttribute("href", ruta + "windows/" + versionsW[j].href);
                    link0.setAttribute("target", "_blank");
                    link0.textContent = versionsW[j].href;

                    var columnWindows1 = document.createElement("td");
                    columnWindows1.setAttribute("id", "column");
                    var link1 = document.createElement("a");
                    columnWindows1.appendChild(link1);
                    rowVersion.appendChild(columnWindows1);
                    var zip = (versionsW[j].href.substring(0, versionsW[j].href.length - 3) + "zip");
                    link1.setAttribute("href", ruta + "windows/" + zip);
                    link1.setAttribute("target", "_blank");
                    link1.textContent = zip;
                }
            }
            if (!windows) {
                rowVersion.appendChild(document.createElement("td"));
                rowVersion.appendChild(document.createElement("td"));
            }

            //Linux versions
            var versionsL = [];
            linuxVersions.forEach(valor => {
                versionsL.push(valor);
            });
            var linux = false;
            for (var j = 0; j < versionsL.length; j++) {
                if (versions[i] == versionsL[j].num) {
                    linux = true;
                    var columnLinux0 = document.createElement("td");
                    rowVersion.appendChild(columnLinux0);
                    var link0 = document.createElement("a")
                    columnLinux0.appendChild(link0);
                    link0.setAttribute("href", ruta + "linux/" + versionsW[j].href);
                    link0.setAttribute("target", "_blank");
                    link0.textContent = versionsL[j].href;

                    var columnLinux1 = document.createElement("td");
                    rowVersion.appendChild(columnLinux1);
                    var zip = (versionsL[j].href.substring(0, versionsL[j].href.length - 6) + "zip");
                    var link1 = document.createElement("a")
                    columnLinux1.appendChild(link1);
                    link1.setAttribute("href", ruta + "linux/" + zip);
                    link1.setAttribute("target", "_blank");
                    link1.textContent = versionsL[j].href;
                }
            }
            if (!linux) {
                rowVersion.appendChild(document.createElement("td"));
                rowVersion.appendChild(document.createElement("td"));
            }

            //Mac versions
            var versionsM = [];
            macVersions.forEach(valor => {
                versionsM.push(valor);
            });
            var mac = false;
            for (var j = 0; j < versionsM.length; j++) {
                if (versions[i] == versionsM[j].num) {
                    mac = true;
                    var name = versionsM[j].href.substring(0, versionsM[j].href.length - 6);

                    var columnMac0 = document.createElement("td");
                    rowVersion.appendChild(columnMac0);
                    var link0 = document.createElement("a")
                    columnMac0.appendChild(link0);
                    link0.setAttribute("href", ruta + "mac/" + name+"zip");
                    link0.setAttribute("target", "_blank");
                    link0.textContent = name + "zip";

                    var columnMac1 = document.createElement("td");
                    rowVersion.appendChild(columnMac1);
                    var link1 = document.createElement("a")
                    columnMac0.appendChild(link1);
                    link1.setAttribute("href", ruta + "mac/" + name+"rar");
                    link1.setAttribute("target", "_blank");
                    link1.textContent = name + "rar";
                }
            }
            if (!mac) {
                rowVersion.appendChild(document.createElement("td"));
                rowVersion.appendChild(document.createElement("td"));
            }
        }
    }


    var resultado = null;

    function loadXMLDoc(src, callback) {
        v = null;

        var request = new XMLHttpRequest();
        var params = "UID=CORS&name=CORS";

        request.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                callback(this.responseXML);
            }
        };

        request.open("POST", src, true);
        request.send(null);
        /*request.onload = function() {
            resultado = xmlhttp.responseXML.documentElement;
            console.log(resultado);
        }*/
        return v;
    }


    function myFunction(xml) {
        //var i;
        var xmlDoc = xml.getElementsByTagName("file");
        /*console.log(xmlDoc);
        console.log(xmlDoc[0].getElementsByTagName("version")[0].childNodes[0].nodeValue);
        console.log(xmlDoc);*/

        //Constructor
        function Version(num, href) {
            this.num = num;
            this.href = href;
        };
        var versions = [];
        for (var i = 0; i < xmlDoc.length; i++) {
            try {
                var n = xmlDoc[i].getElementsByTagName("version")[0].childNodes[0].nodeValue;
                var h = xmlDoc[i].getElementsByTagName("href")[0].childNodes[0].nodeValue;
                var auxVersion = new Version(n, h);
                versions.push(auxVersion);
            } catch (error) {

            }
        }

        //Check the versions
        for (var i = 0; i < versions.length - 1; i++) {
            var numVersion = (versions[i].num).substring(3, 7);
            var numNextVersion = (versions[i + 1].num).substring(3, 7);

            if (numVersion == numNextVersion) {
                versions.splice(i, 1);
            }
        }
        return versions;
    }

</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
</body>
